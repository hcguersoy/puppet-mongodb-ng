// Script to instantiate a mongodb repl set
//
// Generated by Puppet / don't run again after this 
// script has been applied on a replset.

// do an initial 'initiate'
// if the RS already exists this does not anything,
// if not, it configures the RS with a default setup
rs.initiate();

//now configure the (maybe new) RS
rsconf = {
    _id: "<%=@replset%>",
    members: [
<%  replid = 0
    @replsetmembers.each do |replsetmember| %>                
        {
        _id: <%=replid%>,
        host: "<%=replsetmember[0]%>:<%=replsetmember[1]%>"
        },
<%      replid += 1
    end %>         
    ]
}

rs.reconfig(rsconf);